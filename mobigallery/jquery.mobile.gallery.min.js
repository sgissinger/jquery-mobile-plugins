(function(a){a.widget("mobile.gallery",a.mobile.widget,{options:{initSelector:":jqmData(role='gallery')",theme:"c",uselang:"en",lang:{en:{close:"Close gallery",previous:"Previous image",next:"Next image",on:" of "}},transition:"none",hashname:"gallery",slideenabled:true,slidefunction:"ease-out",slideduration:".5s"},_domid:"ui-gallery-page",_linkSelector:":jqmData(role='gallerylink')",_showSelector:":jqmData(show='1')",_gallery:undefined,_footer:undefined,_view:undefined,_selectedImage:undefined,_imagesContainer:undefined,__canTranslate3d:undefined,_create:function(){var b=this;this._gallery=a(this.element);this._gallery.find(this._linkSelector).each(function(){a(this).attr(b._data("href"),a(this).attr("href")).removeAttr("href");a(this).addClass("ui-gallery-link ui-corner-all")}).click(function(){b._gallery.children().removeAttr(b._data("show"));link=a(this);link.parent().attr(b._data("show"),"1");var c=link.attr(b._data("href"));if(c!=""){a("body").append(b._createPage());a.mobile.changePage(a("#"+b._domid),{transition:b.options.transition});a.mobile.loading("show");a('<img src="'+c+'"/>').load(function(){b._createImages(link);b._setTitle(link);a.mobile.loading("hide")})}})},_createPage:function(){var g=this;var b=a("<li>").append(a("<a>",{href:"javascript:history.back();",title:this.__("close")}).buttonMarkup({icon:"delete",iconpos:"notext",theme:this.options.theme}));var d=a("<div>").attr(this._data("role"),"header").append(a("<div>").attr(this._data("role"),"navbar").append(a("<ul>").append(b))).fixedtoolbar({disablePageZoom:false,fullscreen:true});this._footer=a("<div>").attr(this._data("role"),"footer").append(a("<div>").attr(this._data("role"),"navbar")).fixedtoolbar({disablePageZoom:false,fullscreen:true});var f=a("<a>",{href:"javascript:;",title:this.__("previous")}).addClass("ui-header-fullscreen ui-gallery-prev").click(function(i){g._swipe("prev")}).buttonMarkup({icon:"arrow-l",iconpos:"right",theme:this.options.theme});var e=a("<a>",{href:"javascript:;",title:this.__("next")}).addClass("ui-header-fullscreen ui-gallery-next").click(function(i){g._swipe("next")}).buttonMarkup({icon:"arrow-r",theme:this.options.theme});this._view=a("<div>");if(this._canTranslate3d()){this._view.data("pourc",0).css({transitionTimingFunction:this.options.slidefunction})}var h=a("<div>").append(this._view).on("vmousedown",function(i){i.stopPropagation();this.start={pageX:i.pageX,pageY:i.pageY,time:i.timeStamp}}).on("vmousemove",function(j){if(j.touches&&j.touches.length>1||j.scale&&j.scale!==1){return}if(this.start!=undefined){j.preventDefault();j.stopPropagation();if(g._canTranslate3d()){var i=(a(document).width()*g._view.data("pourc"))+j.pageX-this.start.pageX;g._transform("0s",i,"px")}}}).on("vmouseup",function(i){if(this.start!=undefined){if(g._isLeftSwipe(this.start,i)){g._swipe("next")}else{if(g._isRightSwipe(this.start,i)){g._swipe("prev")}else{if(g._canTranslate3d()){g._transform(g.options.slideduration)}}}this.start=undefined}else{if(g._canTranslate3d()){g._transform(g.options.slideduration)}}});var c=a("<div>").attr(this._data("role"),"content").append(f).append(e).append(h);return a("<div>",{id:this._domid}).attr(this._data("role"),"page").attr(this._data("url"),location.pathname+location.search+"#"+this.options.hashname).append(d).append(c).append(this._footer).on("pagehide",function(i){a(this).remove()})},_createImages:function(c){var b=a("<div>").css({backgroundImage:"url("+c.attr(this._data("href"))+")",transform:"translate3d(0%,0,0)"}).data("pourc",0);this._view.append(b);if(this._canTranslate3d()){if(this._gallery.children(this._showSelector).prev().length){prevImg=this._gallery.children(this._showSelector).prev().find(this._linkSelector)}else{prevImg=this._gallery.children(":last-child").find(this._linkSelector)}if(this._gallery.children(this._showSelector).next().length){nextImg=this._gallery.children(this._showSelector).next().find(this._linkSelector)}else{nextImg=this._gallery.children(":first-child").find(this._linkSelector)}var e=a("<div>").css({backgroundImage:"url("+prevImg.attr(this._data("href"))+")",transform:"translate3d(-100%,0,0)"}).data("pourc",-1);var d=a("<div>").css({backgroundImage:"url("+nextImg.attr(this._data("href"))+")",transform:"translate3d(100%,0,0)"}).data("pourc",1);e.insertBefore(b);d.insertAfter(b);this._selectedImage=1;this._imagesContainer=new Array(e,b,d)}else{this._imagesContainer=new Array(b)}},_swipe:function(b){if(!this._canTranslate3d()){a.mobile.loading("show")}var i=this,k=0,e=undefined,h=this._view.data("pourc"),c=undefined,j=willShowElem=this._gallery.children(this._showSelector).removeAttr(this._data("show"));switch(b){case"next":if(j.next().length){willShowElem=j.next()}else{willShowElem=this._gallery.children(":first-child")}if(this._canTranslate3d()){k=(100*h)-100;h--;if(willShowElem.next().length){e=willShowElem.next().find(this._linkSelector)}else{e=this._gallery.children(":first-child").find(this._linkSelector)}this._selectedImage++}else{e=willShowElem.find(this._linkSelector)}break;case"prev":if(j.prev().length){willShowElem=j.prev()}else{willShowElem=this._gallery.children(":last-child")}if(this._canTranslate3d()){k=(100*h)+100;h++;if(willShowElem.prev().length){e=willShowElem.prev().find(this._linkSelector)}else{e=this._gallery.children(":last-child").find(this._linkSelector)}this._selectedImage--}else{e=willShowElem.find(this._linkSelector)}break}willShowElem.attr(this._data("show"),"1");if(e!=undefined){if(this._canTranslate3d()){var d=this._nextImageContainer(b);c=this._imagesContainer[d];var f=c.data("pourc")+(b=="next"?3:-3);c.css({transform:"translate3d("+(100*f)+"%,0,0)"}).data("pourc",f)}else{c=this._imagesContainer[0]}var g=e.attr(this._data("href"));a('<img src="'+g+'"/>').load(function(){c.css({backgroundImage:"url("+g+")"});i._setTitle(willShowElem.find(i._linkSelector));a.mobile.loading("hide")})}if(this._canTranslate3d()){this._transform(this.options.slideduration,k);this._view.data("pourc",h)}},_transform:function(b,c,d){if(b==undefined){b="0s"}if(d==undefined){d="%"}if(c==undefined){c=(100*this._view.data("pourc"))}this._view.css({transitionDuration:b,transform:"translate3d("+c+d+",0,0)"})},_nextImageContainer:function(b){if(this._selectedImage<0){this._selectedImage=2}else{if(this._selectedImage>2){this._selectedImage=0}}if(b=="next"){switch(this._selectedImage){case 0:return 1;case 1:return 2;case 2:return 0}}else{if(b=="prev"){switch(this._selectedImage){case 0:return 2;case 1:return 0;case 2:return 1}}}return 1},_setTitle:function(b){var c=(b.parent().index()+1)+this.__("on")+this._gallery.children().length,d=b.attr("title");if(d!=undefined&&d!=""){this._footer.html(d+"<br/>"+c)}else{this._footer.html(c)}},__:function(b){if(this.options.lang[this.options.uselang][b]!=undefined){return this.options.lang[this.options.uselang][b]}else{return this.options.lang.en[b]}},_data:function(b){return"data-"+a.mobile.ns+b},_isSwipe:function(c,b){return Math.abs(c.pageX-b.pageX)>a.event.special.swipe.horizontalDistanceThreshold},_isLeftSwipe:function(c,b){return this._isSwipe(c,b)&&(c.pageX-b.pageX)>0},_isRightSwipe:function(c,b){return this._isSwipe(c,b)&&(c.pageX-b.pageX)<0},_canTranslate3d:function(){if(this.__canTranslate3d==undefined){this.__canTranslate3d=(!a.mobile.browser.ie||a.mobile.browser.ie>9)&&this.options.slideenabled}return this.__canTranslate3d}});a(document).on("pagecreate create",function(b){a.mobile.gallery.prototype.enhanceWithin(b.target,true)});a.extend(a.mobile.gallery.prototype.options.lang,{fr:{close:"Fermer la galerie",previous:"Image précédente",next:"Image suivante",on:" sur "}})})(jQuery);