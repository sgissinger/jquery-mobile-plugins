(function(a){a.widget("mobile.file",a.mobile.widget,{options:{initSelector:":jqmData(role='file-set')",fileSelector:":jqmData(role='file')",theme:"a",uselang:"en",lang:{en:{remove:"Remove",noFileSelected:"Click or touch this area to select a file...",cannotUseFile:"Your device do not support file upload"}},buttontheme:"b",ismultiple:false,afterdomupdate:"undefined"},_afterDomUpdate:function(){var b=window[this.options.afterdomupdate];if(b!=undefined){b()}},_files:new Array(),_resizeCallback:undefined,_create:function(){var b=this;this._resizeCallback=this._debounce(function(){var c=a(b._files);if(b.option.ismultiple){c=c.slice(0,-1)}c.each(function(){b._resizeWrapper(a(this).parents(".ui-file-wrapper"),a(this),a(this).parents(".ui-file"),a(this).parents(".ui-file").find("a"))})});a(window).on("resize",this._resizeCallback);this._addControl(a(this.element).find(this.options.fileSelector))},_removeControl:function(e,b){var d=this,c=b.clone();if(this._files.length>1||!this.options.ismultiple){e.parent().hide("fast",function(){a(this).remove();d._files.splice(a.inArray(b,d._files),1);d._afterDomUpdate()})}if(!this.options.ismultiple){this._addControl(c)}},_addControl:function(d){var g=this,e=g.options;var f=a("<a>",{href:"javascript:;"}).hide().text(this.__("remove")).click(function(){g._removeControl(h,d)}).buttonMarkup({theme:e.buttontheme});var c=a("<span>").addClass("ui-file-feedback").text(this.__("noFileSelected"));var h=a("<div>").addClass("ui-file-wrapper").mousemove(function(i){d.css({left:i.pageX-a(this).offset().left-d.outerWidth()+3,top:i.pageY-a(this).offset().top-3})});d.addClass("ui-file-input").on("disable",function(){g._disable(h,d,b,f,c)}).on("enable",function(){g._enable(h,d,b,f,c)}).change(function(){g._change(h,d,b,f,c);if(e.ismultiple&&a(this).parents(e.initSelector).find(e.fileSelector).last().val()!=""){g._addControl(a(this).clone())}});if(d.is("[disabled]")){d.trigger("disable")}this._files.push(d);var b=a("<div>").hide().attr(this._data("theme"),e.theme).addClass("ui-file ui-btn ui-btn-corner-all ui-shadow ui-btn-up-"+e.theme).appendTo(a(this.element)).append(f).append(c).append(h.append(d)).show("fast",function(){g._resizeWrapper(h,d,b,f);g._afterDomUpdate()})},_disable:function(f,d,b,e,c){d.attr("disabled",true);b.addClass("ui-disabled");this.disabled=true;if(c.text()==this.__("noFileSelected")){c.text(this.__("cannotUseFile"))}else{e.hide()}this._resizeWrapper(f,d,b,e)},_enable:function(f,d,b,e,c){d.removeAttr("disabled");b.removeClass("ui-disabled");this.disabled=false;if(c.text()==this.__("cannotUseFile")||c.text()==this.__("noFileSelected")){c.text(this.__("noFileSelected"))}else{e.show()}this._resizeWrapper(f,d,b,e)},_change:function(h,d,b,g,c){var f=d.val().split(/\\/).pop();if(f==""){if(this._files.length>1||!this.options.ismultiple){this._removeControl(h,d)}else{c.text(this.options.noFileSelected).removeClass(c.data("fileExt")||"").removeClass("ui-file-feedback-populated");g.hide();this._resizeWrapper(h,d,b,g)}}else{var e="ui-file-ext-"+f.split(".").pop().toLowerCase();c.text(f).removeClass(c.data("fileExt")||"").data("fileExt",e).addClass(e+" ui-file-feedback-populated");g.show();this._resizeWrapper(h,d,b,g)}},_resizeWrapper:function(e,c,b,d){if(d.is(":visible")){w=(b.innerWidth()-d.outerWidth(true))+"px"}else{w="100%"}e.css({width:w});c.css({left:0,top:0})},__:function(b){var c=this.options;if(c.lang[c.uselang][b]!=undefined){return c.lang[c.uselang][b]}else{return c.lang.en[b]}},_data:function(b){return"data-"+a.mobile.ns+b},_debounce:function(b,c){var d,c=c||200;return function(){var f=this,e=arguments;clearTimeout(d);d=setTimeout(function(){b.apply(f,Array.prototype.slice.call(e))},c)}}});a(document).on("pagecreate create",function(b){a.mobile.file.prototype.enhanceWithin(b.target,true)});a.extend(a.mobile.file.prototype.options.lang,{fr:{remove:"Enlever",noFileSelected:"Cliquez ou touchez cette zone pour s√©lectionner un fichier...",cannotUseFile:"Votre appareil ne prend pas en charge l'envoi de fichiers"}})})(jQuery);